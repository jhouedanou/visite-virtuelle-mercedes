<krpano version="1.22">
	
	<!--
		A comparison between the postprocessing blur plugin and the CSS backdrop-blur-filter (layer.bgblur).
		
		Differences:
		- the blur effect seems to be very similar
		- the performance also seems to be very similar
		- there is sometimes a flicker in Chrome-based Browsers with the CSS filter at larger ranges during movement (the Browser seems to skip source pixels)
		- the quality of the CSS filter can be slightly better (less noise) a larger ranges (with the default plugin quaility setting)
		- the postprocessing plugin can only blur webgl-content, the CSS filter also html-content
		- the postprocessing plugin can optionally blur behind webgl-hotspots
		- the postprocessing plugin supports the VR mode
	-->
	

	<!-- include some helpers -->
	<include url="%VIEWER%/plugins/contextmenu.xml" />
	<include url="%VIEWER%/plugins/iphone_fullscreen_swipe.xml" />
	<include url="%VIEWER%/plugins/fps.xml" />	
	
	
	<!-- some examples panos -->
	
	<scene name="example1">
		<view hlookat="-90" vlookat="0" fov="90" />
		<preview url="garden_preview.jpg" />
		<image>
			<cube url="garden_%s.jpg" />
		</image>
	</scene>

	<scene name="example2" autoload="true">
		<view hlookat="0" vlookat="0" fov="90" />
		<preview url="../custom-contextmenu/preview.jpg" />
		<image>
			<cube url="../custom-contextmenu/mobile_%s.jpg" />
		</image>
	</scene>

	<scene name="videoexample">
		<plugin name="video" url="%VIEWER%/plugins/videoplayer.js" videourl="../videopano/video-1920x960.mp4|../videopano/video-1920x960.webm" posterurl="../videopano/video-1920x960-poster.jpg" loop="true" muted="true" />
		<image>
			<sphere url="plugin:video" />
		</image>
		<events onclick="plugin[video].togglepause();" />
	</scene>
	
	
	<!-- thumbs for loading the examples -->
	
	<style name="thumb" bgborder="3 0xFFFFFF 1" bgshadow="0 0 1 0 0x000000 1.0 inset,0 3 4 0x000000 0.5" width="relink:stagewidth:stagewidth LT 550 ? 90 : 120" height="prop" />
	<style name="thumbtext" type="text" enabled="false" align="bottom" y="4" css="color:#FFFFFF;" bg="false" txtshadow="0 1 2.0 0x000000 1.0" />
	
	<layer keep="true" type="container" flowchildren="h" childflowspacing="16" align="bottom" y="32" zorder="1" >
		<layer style="thumb" url="garden_thumb.jpg" onclick="loadscene(example1,null,MERGE,OPENBLEND(0.5, 0.0, 0.75, 0.05, linear));">
			<layer style="thumbtext" text="Example 1" />
		</layer>
		<layer style="thumb" url="paris_thumb.jpg" onclick="loadscene(example2,null,MERGE,OPENBLEND(0.5, 0.0, 0.75, 0.05, linear));">
			<layer style="thumbtext" text="Example 2" />
		</layer>
		<layer style="thumb" url="video_thumb.jpg" onclick="loadscene(videoexample,null,MERGE,OPENBLEND(0.5, 0.0, 0.75, 0.05, linear));">
			<layer style="thumbtext" text="Video Example" />
		</layer>
	</layer>
	


	<!-- the postprocessing plugin -->
	<plugin name="ppblur" keep="true"
		url="%VIEWER%/plugins/pp_blur.js"
		enabled="true"
		range="10.0"
		quality="10"
		linearrgb="false"
		mirroredges="true"
		phase="1"
		/>

	<!-- layer with bgblur 
		- the blur ranges are a bit different:
		- the plugin uses device-pixels, the filter css-pixels
		- in the plugin the range is a diameter, in the filter a radius
		- additionally also a small factor needs to be used to get similar results
	-->
	<layer name="bgblur" keep="true"
		type="container"
		width="100%"
		height="100%"
		bgblur="link:plugin[ppblur].range:plugin[ppblur].range*0.5*0.9/device.pixelratio"
		zorder="0"
		enabled="false"
		visible="false"
		/>



	<layer keep="true"
		type="text"
		text="[b]Blur Comparison[/b][br][small]Postprocessing Plugin and CSS Backdrop Filter[/small]"
		css="font-size:18px; color:white;"
		txtshadow="0 2 4 0x000000 1.0"
		textalign="center"
		bg="false"
		align="top"
		y="10%"
		enabled="false"
		/>
	
	<style name="button"
		type="text"
		padding="8"
		width="180"
		textalign="center"
		bgborder="1 0x777777 0.5"
		bgshadow="0 1 2 0x000000 1"
		/>
		
	<layer style="button" keep="true"
		template="Blur-Range: {{plugin[ppblur].range:roundval(plugin[ppblur].range,1)}}"
		align="bottom" x="0" y="190"
		ondown="asyncloop(pressed, plugin[ppblur].range = clamp(0,plugin[ppblur].range + mouse.dx*0.1, 100); );"
		ondoubleclick="plugin[ppblur].range=0;"
		cursor="ew-resize"
		/>
	
	<layer style="button" keep="true"
		align="bottom" x="0" y="150"
		mode="1"
		onloaded="set_blurmode(get(mode));"
		onclick="switch(mode,1,2); onloaded();"
		/>
	
	<action name="set_blurmode" scope="local" args="mode">
		if(mode == 1,
			caller.text = "Mode: Postprocessing Plugin";
			plugin[ppblur].enabled = true;
			layer[bgblur].visible = false;
		  ,
			caller.text = "Mode: CSS Backdrop Filter";
			plugin[ppblur].enabled = false;
			layer[bgblur].visible = true;
		);
	</action>
	

</krpano>
